openapi: 3.0.0

info:
  title: 'Pinnacle API'
  description: 'The complete API for the Pinnacle platform.'
  version: '1.0.0'

servers:
  - url: 'http://localhost:3000'
    description: 'Local Development Server'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    id:
      name: id
      in: path
      required: true
      description: 'The unique identifier of the resource.'
      schema:
        type: string
    jobId:
      name: jobId
      in: path
      required: true
      description: 'The unique identifier of the job.'
      schema:
        type: string
    applicationId:
      name: applicationId
      in: path
      required: true
      description: 'The unique identifier of the application.'
      schema:
        type: string

security:
  - bearerAuth: []

# API Endpoints
paths:
  # System
  /health:
    get:
      summary: 'Health Check'
      tags: [System]
      security: [] # Public endpoint
      responses: { '200': { description: 'Service is healthy.' } }

  # Auth
  /auth/google/login:
    get: { summary: 'Initiate Google OAuth Login', tags: [Auth], security: [] }
  /auth/google/callback:
    get: { summary: 'Google OAuth Callback', tags: [Auth], security: [] }
  /auth/refresh:
    post: { summary: 'Refresh Access Token', tags: [Auth], security: [] }
  /auth/me:
    get: { summary: 'Get Current Authenticated User', tags: [Auth] }

  # User Details (Student Profile)
  /api/user-details/profile:
    get: { summary: "Get user's core profile", tags: [UserDetails] }
    patch: { summary: "Update user's core profile", tags: [UserDetails] }
  /api/user-details/experiences:
    get: { summary: 'Get all experiences', tags: [UserDetails] }
    post: { summary: 'Create an experience', tags: [UserDetails] }
  /api/user-details/experiences/{id}:
    patch:
      {
        summary: 'Update an experience',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete an experience',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/education:
    get: { summary: 'Get all education entries', tags: [UserDetails] }
    post: { summary: 'Create an education entry', tags: [UserDetails] }
  /api/user-details/education/{id}:
    patch:
      {
        summary: 'Update an education entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete an education entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/skills:
    get: { summary: 'Get all skills', tags: [UserDetails] }
    post: { summary: 'Create a skill entry', tags: [UserDetails] }
  /api/user-details/skills/{id}:
    patch:
      {
        summary: 'Update a skill entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a skill entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/projects:
    get: { summary: 'Get all projects', tags: [UserDetails] }
    post: { summary: 'Create a project entry', tags: [UserDetails] }
  /api/user-details/projects/{id}:
    patch:
      {
        summary: 'Update a project entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a project entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/certifications:
    get: { summary: 'Get all certifications', tags: [UserDetails] }
    post: { summary: 'Create a certification entry', tags: [UserDetails] }
  /api/user-details/certifications/{id}:
    patch:
      {
        summary: 'Update a certification entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a certification entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/languages:
    get: { summary: 'Get all languages', tags: [UserDetails] }
    post: { summary: 'Create a language entry', tags: [UserDetails] }
  /api/user-details/languages/{id}:
    patch:
      {
        summary: 'Update a language entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a language entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }

  # Company & Job Management (Admin)
  /api/companies:
    get: { summary: 'Get all companies', tags: [Company] }
    post: { summary: 'Create a company (Admin Only)', tags: [Company] }
  /api/companies/{id}:
    get:
      {
        summary: 'Get company by ID',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    patch:
      {
        summary: 'Update a company (Admin Only)',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a company (Admin Only)',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/companies/search:
    get:
      summary: 'Search for companies'
      tags: [Company]
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }

  # Jobs Management
  /api/jobs:
    get:
      summary: 'Get all available jobs'
      description: 'Public endpoint - returns all open job postings'
      tags: [Jobs]
      security: [] # Public endpoint
    post:
      summary: 'Create a new job posting'
      description: 'Admin only - create a new job posting'
      tags: [Jobs]
  /api/jobs/{id}:
    get:
      summary: 'Get a single job by ID'
      description: 'Public endpoint - get details of a specific job'
      tags: [Jobs]
      security: [] # Public endpoint
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/jobs/{id}/close:
    patch:
      summary: 'Close a job posting'
      description: 'Admin only - close/deactivate a job posting'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/jobs/{jobId}/applications:
    post:
      summary: 'Apply to a job'
      description: 'Authenticated users can submit an application to a job'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/jobId' }]
    get:
      summary: 'Get all applications for a job'
      description: 'Admin only - view all applicants for a specific job'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/jobId' }]

  # Applications Management
  /api/applications:
    get:
      summary: 'Get my applications'
      description: 'Get all applications submitted by the current user'
      tags: [Applications]
  /api/applications/{id}/status:
    patch:
      summary: "Update an application's status"
      description: 'Admin only - update the status of an application (e.g., accepted, rejected)'
      tags: [Applications]
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/applications/{id}/withdraw:
    post:
      summary: 'Withdraw an application'
      description: 'Users can withdraw their own application'
      tags: [Applications]
      parameters: [{ $ref: '#/components/parameters/id' }]

  # Resume
  /api/resume/preview:
    get: { summary: 'Get user data for resume preview', tags: [Resume] }
  /api/resume/templates:
    get: { summary: 'Get available resume templates', tags: [Resume] }
  /api/resume/saved:
    get: { summary: 'Get all saved resumes', tags: [Resume] }
    post: { summary: 'Create a new saved resume', tags: [Resume] }
  /api/resume/saved/{id}:
    get:
      {
        summary: 'Get a specific saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    patch:
      {
        summary: 'Update a saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/resume/generate:
    post: { summary: 'Generate PDF for authenticated user', tags: [Resume] }
  /api/resume/generate/{userId}:
    post:
      {
        summary: 'Generate PDF for a specific user (Admin Only)',
        tags: [Resume],
        parameters: [{ name: userId, in: path, required: true, schema: { type: string } }],
      }

  # Dashboard
  /api/dashboard:
    get: { summary: 'Get all user data in one request', tags: [Dashboard] }
  /api/dashboard/stats:
    get: { summary: 'Get user statistics', tags: [Dashboard] }
  /api/dashboard/profile-completion:
    get: { summary: 'Get profile completion percentage', tags: [Dashboard] }

  # Notifications
  /api/notify:
    post: { summary: 'Send a notification', tags: [Notification] } # Assuming this is the path
