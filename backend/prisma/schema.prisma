// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../../packages/types/node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

enum AccomplishmentType {
  AWARD
  CERTIFICATION
  COMPETITION
  CONFERENCE
  TEST_SCORE
  PATENT
  PUBLICATION
  SCHOLARSHIP
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  name     String
  picture  String?
  googleId String   @unique
  role     UserRole @default(USER)

  // User Profile Details
  phone    String?
  location String?
  linkedin String?
  github   String?
  website  String?
  bio      String?
  title    String?

  // Resume-related fields
  summary    String?
  isVerified Boolean @default(false)

  // Timestamps
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  // Relations
  experiences               Experience[]
  education                 Education[]
  skills                    Skill[]
  projects                  Project[]
  certifications            Certification[]
  languages                 Language[]
  resumes                   Resume[]
  positionsOfResponsibility PositionOfResponsibility[]
  courses                   Course[]
  accomplishments           Accomplishment[]
  extracurriculars          Extracurricular[]

  @@index([email])
  @@index([googleId])
  @@index([deletedAt])
}

model Experience {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  company     String
  position    String
  location    String
  startDate   String
  endDate     String?
  current     Boolean  @default(false)
  description String?
  highlights  String[] @default([])
  order       Int      @default(0)
  isVerified  Boolean  @default(false)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Education {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  institution  String
  degree       String
  field        String
  location     String
  startDate    String
  endDate      String?
  gpa          String?
  achievements String[] @default([])
  order        Int      @default(0)
  isVerified   Boolean  @default(false)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Skill {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  category String
  items    String[] @default([])
  order    Int      @default(0)
  isVerified Boolean @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Project {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name         String
  description  String
  technologies String[] @default([])
  url          String?
  github       String?
  highlights   String[] @default([])
  order        Int      @default(0)
  isVerified   Boolean  @default(false)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Certification {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name   String
  issuer String
  date   String
  url    String?
  order  Int     @default(0)
  isVerified Boolean @default(false)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Language {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  proficiency String // Native, Fluent, Professional, Basic
  order       Int    @default(0)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Accomplishment {
  id     String            @id @default(uuid())
  userId String
  user   User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  type        AccomplishmentType
  title       String
  issuer      String? // Organization, institution, or issuing body
  date        String
  description String?
  url         String?
  metadata    Json? // For type-specific additional data
  order       Int     @default(0)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([type])
  @@index([deletedAt])
}

model Extracurricular {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  activity    String
  role        String?
  organization String?
  startDate   String?
  endDate     String?
  current     Boolean  @default(false)
  description String?
  order       Int      @default(0)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model PositionOfResponsibility {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title        String
  organization String
  location     String?
  startDate    String
  endDate      String?
  current      Boolean  @default(false)
  description  String?
  highlights   String[] @default([])
  order        Int      @default(0)
  isVerified   Boolean  @default(false)
  verificationDoc String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Course {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name         String
  institution  String
  completionDate String?
  grade        String?
  description  String?
  url          String?
  order        Int     @default(0)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model Resume {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title    String
  template String @default("modern")
  data     Json // Full resume data structure

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  file       ResumeFile?

  deletedAt DateTime? // Soft delete

  @@index([userId])
  @@index([deletedAt])
}

model ResumeFile{
  id         String   @id @default(uuid())
  resumeId   String   @unique

  bucket     String
  objectKey  String
  mimeType   String
  size       Int

  createdAt DateTime @default(now())

  resume     Resume   @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Company {
  id String @id @default(uuid())

  name        String
  website     String?
  description String?
  logo        String?
  industry    String?
  size        String? // e.g., "1-10", "11-50", "51-200", etc.
  location    String?

  // Contact details
  email String?
  phone String?

  // Social media
  linkedin String?

  // Timestamps
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  // Relations
  jobs Job[]

  @@index([name])
  @@index([deletedAt])
}



enum ApplicationStatus {
  APPLIED
  SHORTLISTED
  INTERVIEWING
  REJECTED
  HIRED
  WITHDRAWN
}

enum JobStatus {
  OPEN
  CLOSED
  PAUSED
}

model Job {
  id        String  @id @default(uuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  title               String
  description         String?
  descriptionDocument String? // CDN URL for job description document/PDF
  location            String?
  type                String? // Full-time, Part-time, Internship
  salary              String?
  deadline            DateTime?
  status              JobStatus @default(OPEN)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  questions    JobQuestion[]
  applications Application[]

  @@index([companyId])
  @@index([status])
  @@index([deletedAt])
}

model JobQuestion {
  id    String @id @default(uuid())
  jobId String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)

  question String
  required Boolean @default(true)
  order    Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([jobId])
}

model Application {
  id       String  @id @default(uuid())
  userId   String
  jobId    String
  job      Job     @relation(fields: [jobId], references: [id])
  resumeId String? // Selected resume version

  status      ApplicationStatus @default(APPLIED)
  coverLetter String?
  answers     Json? // Answers to job questions { questionId: answer }

  appliedAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  withdrawnAt DateTime?

  @@unique([userId, jobId]) // Prevent duplicate applications
  @@index([userId])
  @@index([jobId])
  @@index([status])
}
