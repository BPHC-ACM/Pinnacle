openapi: 3.0.0

info:
  title: 'Pinnacle API'
  description: 'The complete API for the Pinnacle platform.'
  version: '1.0.0'

servers:
  - url: 'http://localhost:3000'
    description: 'Local Development Server'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    id:
      name: id
      in: path
      required: true
      description: 'The unique identifier of the resource.'
      schema:
        type: string
    jobId:
      name: jobId
      in: path
      required: true
      description: 'The unique identifier of the job.'
      schema:
        type: string
    applicationId:
      name: applicationId
      in: path
      required: true
      description: 'The unique identifier of the application.'
      schema:
        type: string

security:
  - bearerAuth: []

# API Endpoints
paths:
  # System
  /health:
    get:
      summary: 'Health Check'
      tags: [System]
      security: [] # Public endpoint
      responses: { '200': { description: 'Service is healthy.' } }

  # Auth
  /auth/google/login:
    get: { summary: 'Initiate Google OAuth Login', tags: [Auth], security: [] }
  /auth/google/callback:
    get: { summary: 'Google OAuth Callback', tags: [Auth], security: [] }
  /auth/refresh:
    post: { summary: 'Refresh Access Token', tags: [Auth], security: [] }
  /auth/me:
    get: { summary: 'Get Current Authenticated User', tags: [Auth] }

  # User Details (Student Profile)
  /api/user-details/profile:
    get: { summary: "Get user's core profile", tags: [UserDetails] }
    patch: { summary: "Update user's core profile", tags: [UserDetails] }
  /api/user-details/experiences:
    get: { summary: 'Get all experiences', tags: [UserDetails] }
    post: { summary: 'Create an experience', tags: [UserDetails] }
  /api/user-details/experiences/{id}:
    patch:
      {
        summary: 'Update an experience',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete an experience',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/education:
    get: { summary: 'Get all education entries', tags: [UserDetails] }
    post: { summary: 'Create an education entry', tags: [UserDetails] }
  /api/user-details/education/{id}:
    patch:
      {
        summary: 'Update an education entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete an education entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/skills:
    get: { summary: 'Get all skills', tags: [UserDetails] }
    post: { summary: 'Create a skill entry', tags: [UserDetails] }
  /api/user-details/skills/{id}:
    patch:
      {
        summary: 'Update a skill entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a skill entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/projects:
    get: { summary: 'Get all projects', tags: [UserDetails] }
    post: { summary: 'Create a project entry', tags: [UserDetails] }
  /api/user-details/projects/{id}:
    patch:
      {
        summary: 'Update a project entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a project entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/certifications:
    get: { summary: 'Get all certifications', tags: [UserDetails] }
    post: { summary: 'Create a certification entry', tags: [UserDetails] }
  /api/user-details/certifications/{id}:
    patch:
      {
        summary: 'Update a certification entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a certification entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/user-details/languages:
    get: { summary: 'Get all languages', tags: [UserDetails] }
    post: { summary: 'Create a language entry', tags: [UserDetails] }
  /api/user-details/languages/{id}:
    patch:
      {
        summary: 'Update a language entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a language entry',
        tags: [UserDetails],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }

  # Company & Job Management (Admin)
  /api/companies:
    get: { summary: 'Get all companies', tags: [Company] }
    post: { summary: 'Create a company (Admin Only)', tags: [Company] }
  /api/companies/{id}:
    get:
      {
        summary: 'Get company by ID',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    patch:
      {
        summary: 'Update a company (Admin Only)',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a company (Admin Only)',
        tags: [Company],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/companies/search:
    get:
      summary: 'Search for companies'
      tags: [Company]
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }

  # Jobs Management
  /api/jobs:
    get:
      summary: 'Get all available jobs'
      description: 'Public endpoint - returns all open job postings'
      tags: [Jobs]
      security: [] # Public endpoint
    post:
      summary: 'Create a new job posting'
      description: 'Admin only - create a new job posting'
      tags: [Jobs]
  /api/jobs/{id}:
    get:
      summary: 'Get a single job by ID'
      description: 'Public endpoint - get details of a specific job'
      tags: [Jobs]
      security: [] # Public endpoint
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/jobs/{id}/close:
    patch:
      summary: 'Close a job posting'
      description: 'Admin only - close/deactivate a job posting'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/jobs/{jobId}/applications:
    post:
      summary: 'Apply to a job'
      description: 'Authenticated users can submit an application to a job'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/jobId' }]
    get:
      summary: 'Get all applications for a job'
      description: 'Admin only - view all applicants for a specific job'
      tags: [Jobs]
      parameters: [{ $ref: '#/components/parameters/jobId' }]

  # Applications Management
  /api/applications:
    get:
      summary: 'Get my applications'
      description: 'Get all applications submitted by the current user'
      tags: [Applications]
  /api/applications/{id}/status:
    patch:
      summary: "Update an application's status"
      description: 'Admin only - update the status of an application (e.g., accepted, rejected)'
      tags: [Applications]
      parameters: [{ $ref: '#/components/parameters/id' }]
  /api/applications/{id}/withdraw:
    post:
      summary: 'Withdraw an application'
      description: 'Users can withdraw their own application'
      tags: [Applications]
      parameters: [{ $ref: '#/components/parameters/id' }]

  # Resume
  /api/resume/preview:
    get: { summary: 'Get user data for resume preview', tags: [Resume] }
  /api/resume/templates:
    get: { summary: 'Get available resume templates', tags: [Resume] }
  /api/resume/saved:
    get: { summary: 'Get all saved resumes', tags: [Resume] }
    post: { summary: 'Create a new saved resume', tags: [Resume] }
  /api/resume/saved/{id}:
    get:
      {
        summary: 'Get a specific saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    patch:
      {
        summary: 'Update a saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
    delete:
      {
        summary: 'Delete a saved resume',
        tags: [Resume],
        parameters: [{ $ref: '#/components/parameters/id' }],
      }
  /api/resume/generate:
    post: { summary: 'Generate PDF for authenticated user', tags: [Resume] }
  /api/resume/generate/{userId}:
    post:
      {
        summary: 'Generate PDF for a specific user (Admin Only)',
        tags: [Resume],
        parameters: [{ name: userId, in: path, required: true, schema: { type: string } }],
      }

  /api/resume/download/{resumeId}:
    get:
      summary: 'Get download URL for a stored resume PDF'
      description: 'Returns a presigned URL that expires in 1 hour'
      tags: [Resume]
      parameters:
        [
          {
            name: resumeId,
            in: path,
            required: true,
            description: 'The ID of the saved resume',
            schema: { type: string },
          },
        ]

  /api/resume/file-info/{resumeId}:
    get:
      summary: 'Get metadata about stored resume PDF file'
      description: 'Returns file metadata (size, mimeType, createdAt, etc.)'
      tags: [Resume]
      parameters:
        [
          {
            name: resumeId,
            in: path,
            required: true,
            description: 'The ID of the saved resume',
            schema: { type: string },
          },
        ]

  /api/resume/file/{resumeId}:
    delete:
      summary: 'Delete stored resume PDF file from storage'
      description: 'Removes the PDF file from cloud storage'
      tags: [Resume]
      parameters:
        [
          {
            name: resumeId,
            in: path,
            required: true,
            description: 'The ID of the saved resume',
            schema: { type: string },
          },
        ]

  # Dashboard
  /api/dashboard:
    get: { summary: 'Get all user data in one request', tags: [Dashboard] }
  /api/dashboard/stats:
    get: { summary: 'Get user statistics', tags: [Dashboard] }
  /api/dashboard/profile-completion:
    get: { summary: 'Get profile completion percentage', tags: [Dashboard] }

  # Admin Management
  /api/admin/dashboard:
    get:
      summary: 'Get admin dashboard statistics'
      description: 'Admin only - get overall platform statistics'
      tags: [Admin]

  /api/admin/jobs:
    get:
      summary: 'Get all jobs with stats (Admin)'
      description: 'Admin only - get all jobs with application statistics and filters'
      tags: [Admin]
    post:
      summary: 'Create a new job posting (Admin)'
      description: 'Admin only - create a new job posting'
      tags: [Admin]

  /api/admin/jobs/{id}:
    get:
      summary: 'Get job by ID (Admin)'
      description: 'Admin only - get detailed job information'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]
    patch:
      summary: 'Update job details (Admin)'
      description: 'Admin only - update job information'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]
    delete:
      summary: 'Delete job (Admin)'
      description: 'Admin only - soft delete a job posting'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/jobs/{id}/pause:
    patch:
      summary: 'Pause a job (Admin)'
      description: 'Admin only - pause a job posting'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/jobs/{id}/reopen:
    patch:
      summary: 'Reopen a job (Admin)'
      description: 'Admin only - reopen a closed or paused job posting'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/jobs/{id}/export:
    get:
      summary: 'Export job applications (Admin)'
      description: 'Admin only - export all applications for a job'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/jobs/{jobId}/applications:
    get:
      summary: 'Get applications for job (Admin)'
      description: 'Admin only - get all applications for a specific job'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/jobId' }]

  /api/admin/applications:
    get:
      summary: 'Get all applications (Admin)'
      description: 'Admin only - get all applications with filters'
      tags: [Admin]

  /api/admin/applications/{id}:
    get:
      summary: 'Get application details (Admin)'
      description: 'Admin only - get detailed application information'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]
    delete:
      summary: 'Delete application (Admin)'
      description: 'Admin only - delete an application'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/applications/{id}/status:
    patch:
      summary: 'Update application status (Admin)'
      description: 'Admin only - update the status of an application'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/applications/{id}/profile:
    get:
      summary: 'Get applicant profile (Admin)'
      description: 'Admin only - get full profile of an applicant'
      tags: [Admin]
      parameters: [{ $ref: '#/components/parameters/id' }]

  /api/admin/applications/bulk-status:
    post:
      summary: 'Bulk update application status (Admin)'
      description: 'Admin only - update status of multiple applications at once'
      tags: [Admin]

  # Upload / CDN
  /api/upload/profile-picture:
    post:
      summary: 'Upload user profile picture'
      description: 'Authenticated users can upload a profile picture (max 5MB, images only)'
      tags: [Upload]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: 'Profile picture uploaded successfully'
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: 'Presigned URL to access the uploaded image'
                  message:
                    type: string
    delete:
      summary: 'Delete user profile picture'
      description: 'Authenticated users can delete their profile picture'
      tags: [Upload]
      responses:
        '200':
          description: 'Profile picture deleted successfully'

  /api/upload/company-logo/{companyId}:
    post:
      summary: 'Upload company logo (Admin)'
      description: 'Admin only - upload a company logo (max 5MB, images only)'
      tags: [Upload]
      parameters:
        - name: companyId
          in: path
          required: true
          description: 'The ID of the company'
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: 'Company logo uploaded successfully'
    delete:
      summary: 'Delete company logo (Admin)'
      description: 'Admin only - delete a company logo'
      tags: [Upload]
      parameters:
        - name: companyId
          in: path
          required: true
          description: 'The ID of the company'
          schema:
            type: string
      responses:
        '200':
          description: 'Company logo deleted successfully'

  /api/upload/job-document/{jobId}:
    post:
      summary: 'Upload job description document (Admin)'
      description: 'Admin only - upload a job description document (max 10MB, PDF/DOC/DOCX)'
      tags: [Upload]
      parameters:
        - name: jobId
          in: path
          required: true
          description: 'The ID of the job'
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: 'Job document uploaded successfully'
    delete:
      summary: 'Delete job description document (Admin)'
      description: 'Admin only - delete a job description document'
      tags: [Upload]
      parameters:
        - name: jobId
          in: path
          required: true
          description: 'The ID of the job'
          schema:
            type: string
      responses:
        '200':
          description: 'Job document deleted successfully'
